version: '3.9'

services:
  db:
    image: supabase/postgres:15.1.0.117
    restart: unless-stopped
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=postgres
    ports:
      - "54322:5432"
    volumes:
      - supabase_db_data:/var/lib/postgresql/data

  kong:
    image: kong:2.8.1
    restart: unless-stopped
    environment:
      - KONG_DATABASE=off
      - KONG_DECLARATIVE_CONFIG=/var/lib/kong/kong.yml
      - KONG_PROXY_LISTEN=0.0.0.0:8000
    ports:
      - "8000:8000"

  studio:
    image: supabase/studio:20250120-5f6d30c
    restart: unless-stopped
    environment:
      - STUDIO_PG_META_URL=http://meta:8080
    ports:
      - "3000:3000"

  meta:
    image: supabase/postgres-meta:v0.84.2
    restart: unless-stopped
    environment:
      - PG_META_DB_HOST=db
      - PG_META_DB_PASSWORD=${POSTGRES_PASSWORD}
      - PG_META_DB_NAME=postgres
      - PG_META_DB_USER=postgres

volumes:
  supabase_db_data:
